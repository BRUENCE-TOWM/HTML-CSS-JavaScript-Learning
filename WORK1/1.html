<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>心灵奇旅</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="css/style.css">
		<style>
			/* 补充缺失的样式 */
			.submit-btn.active {
				background-color: #fcd34d;
				transform: scale(1.05);
				box-shadow: 0 0 15px rgba(251, 191, 36, 0.6);
				transition: all 0.3s ease;
			}
			.word-count {
				color: #c7d2fe;
				font-size: 0.85rem;
				margin-left: 10px;
			}
			.awards-container {
				z-index: 3; /* 确保获奖信息在遮罩层上方 */
			}
		</style>
	</head>

	<body>
		<header class="movie-title">
			<div class="title-over">
				<h1>心灵奇旅<br><span class="sub-title">Soul</span></h1>
				<div class="tagline">生命的意义，藏在每一个呼吸之间</div>
			</div>
		</header>

		<section class="movie-info">
			<div class="post-container">
				<img src="img/post.jpg" alt="心灵奇旅海报" class="movie-poster">
				<div class="poster-extra">
					<div class="rate">
						<span class="rate-score">8.7</span>
						<span class="rate-text">豆瓣</span>
					</div>
				</div>
			</div>

			<div class="movie-details">
				<div class="info-grid">
					<div class="info-item"><strong>导演：</strong><a href="https://www.douban.com/personage/27228530/"
							class="intruduction" target="_blank">彼特·道格特</a>、<a href="https://www.douban.com/personage/27588392/"
							class="intruduction" target="_blank">凯普·鲍尔斯</a></div>
					<div class="info-item"><strong>主演：</strong><a href="https://www.douban.com/personage/27242078/"
							class="intruduction" target="_blank">杰米·福克斯</a>、<a href="https://www.douban.com/personage/27250486/"
							class="intruduction" target="_blank">蒂娜·菲</a></div>
					<div class="info-item"><strong>类型：</strong>动画、冒险、喜剧、奇幻、音乐</div>
					<div class="info-item"><strong>年份：</strong>2020</div>
					<div class="info-item"><strong>国家/地区：</strong>美国</div>
					<div class="info-item"><strong>语言：</strong>英语</div>
					<div class="info-item"><strong>片长：</strong>101分钟</div>
				</div>
			</div>
			<div class="people-container">
				<div class="person-card">
					<a href="https://www.douban.com/personage/27228530/" class="intruduction" target="_blank">
						<img src="img/Peter.jpg" alt="彼特·道格特" class="person-avatar">
						<div class="person-name">彼特·道格特</div>
						<div class="person-role">导演</div>
					</a>
				</div>
				<div class="person-card">
					<a href="https://www.douban.com/personage/27588392/" class="intruduction" target="_blank">
						<img src="img/Kemp.jpg" alt="凯普·鲍尔斯" class="person-avatar">
						<div class="person-name">凯普·鲍尔斯</div>
						<div class="person-role">导演</div>
					</a>
				</div>
				<div class="person-card">
					<a href="https://www.douban.com/personage/27242078/" class="intruduction" target="_blank">
						<img src="img/Jamie.jpg" alt="杰米·福克斯" class="person-avatar">
						<div class="person-name">杰米·福克斯</div>
						<div class="person-role">配Joe Gardner</div>
					</a>
				</div>
				<div class="person-card">
					<a href="https://www.douban.com/personage/27250486/" class="intruduction" target="_blank">
						<img src="img/Tina.jpg" alt="蒂娜·菲" class="person-avatar">
						<div class="person-name">蒂娜·菲</div>
						<div class="person-role">配 22</div>
					</a>
				</div>
			</div>
			<div class="awards-container">
			    <h3 class="awards-title">获奖荣誉</h3>
			    <ul class="awards-list">
			        <li class="awards-item">
			            <a href="https://movie.douban.com/awards/cannes/73/" class="award" target="_blank">
			                第73届届戛纳电影节 动画片(提名)
			            </a>
			        </li>
			        <li class="awards-item">
			            <a href="https://movie.douban.com/awards/golden-globes/78/" class="award" target="_blank">
			                第78届金球奖 电影类 最佳动画长片
			            </a>
			        </li>
			        <li class="awards-item">
			            <a href="https://movie.douban.com/awards/bafta/74/" class="award" target="_blank">
			                第74届英国电影学院奖 电影奖 最佳动画片
			            </a>
			        </li>
			    </ul>
			</div>
		</section>

		<section class="synopsis">
			<h2>剧情介绍</h2>
			<div class="synopsis-content">
				<p class="darkness">
					&nbsp;&nbsp;&nbsp;&nbsp;乔伊·高纳是一位生活在纽约市的中学音乐老师，他一直梦想着能在舞台上演奏爵士乐。当他终于获得了与传奇爵士乐手多萝西娅·威廉姆斯同台演出的机会时，却在兴奋之余意外掉进了一个下水道，醒来后发现自己来到了一个奇幻的地方——"灵魂世界"。
				</p>
				<p class="lighting">
					&nbsp;&nbsp;&nbsp;&nbsp;在那里，乔伊遇到了一个拒绝前往地球的灵魂"22号"，她对人类生活毫无兴趣，认为人生没有意义。为了回到自己的身体，乔伊必须帮助22号找到对生活的热情。在这个过程中，两人一同经历了一系列奇妙的冒险，也逐渐明白了<strong>生命的真谛：人生的意义不在于达成某个宏伟目标，而在于珍惜当下的每一个平凡瞬间。</strong>
				</p>
			</div>
		</section>
		
		<section class="comment-section">
		    <h2 class="comment-title">观众评论</h2>
		    <div class="comment-list">
		        <div class="comment-card">
		            <div class="comment-header">
		                <img src="img/c.jpg" alt="用户头像" class="user-avatar">
		                <div class="user-info">
		                    <h4 class="user-name">言铖</h4>
		                    <p class="comment-time">2024-10-28 15:30</p>
		                </div>
		                <div class="comment-rating">★★★★★</div>
		            </div>
		            <p class="comment-content">
		                看到乔伊和22号在灵魂世界的冒险时，完全被戳中了！尤其是最后明白“人生意义在当下”的瞬间，突然觉得平凡的日常也超珍贵，画面和立意都满分～
		            </p>
		        </div>
		        <div class="comment-card">
		            <div class="comment-header">
		                <img src="img/y.jpg" alt="用户头像" class="user-avatar">
		                <div class="user-info">
		                    <h4 class="user-name">一叶孤舟</h4>
		                    <p class="comment-time">2024-10-27 20:15</p>
		                </div>
		                <div class="comment-rating">★★★★☆</div>
		            </div>
		            <p class="comment-content">
		                音乐和画面的融合太绝了！不过最打动我的不是爵士乐梦想，而是22号对“活着”的抗拒到接纳的过程，像在看自己和生活的和解，很治愈。
		            </p>
		        </div>
		        <div class="comment-card">
		            <div class="comment-header">
		                <img src="img/yy.png" alt="用户头像" class="user-avatar">
		                <div class="user-info">
		                    <h4 class="user-name">口十言成</h4>
		                    <p class="comment-time">2024-10-26 18:40</p>
		                </div>
		                <div class="comment-rating">★★★★★</div>
		            </div>
		            <p class="comment-content">
		                刷了两遍！第一次被剧情吸引，第二次注意到很多细节——比如灵魂世界的色彩变化，从冷蓝到暖金，完全和主角心境同步，太用心了！
		            </p>
		        </div>
		    </div>
		    <div class="comment-input-box">
		        <h3 class="input-title">分享你的看法</h3>
		        <textarea class="comment-textarea" placeholder="说说你对这部电影的感受..." maxlength="500"></textarea>
		        <div class="comment-submit-bar">
		            <div class="submit-rating">
		                <span>评分：</span>
		                <div class="rating-stars">★★★★★</div>
		                <span class="word-count">0/500</span>
		            </div>
		            <button class="submit-btn">发布评论</button>
		        </div>
		    </div>
		</section>

		<script>
			// 性能优化：使用IIFE封装避免全局变量污染
			(() => {
				// 缓存DOM元素提升性能
				const dom = {
					ratingStars: document.querySelector('.rating-stars'),
					submitBtn: document.querySelector('.submit-btn'),
					commentTextarea: document.querySelector('.comment-textarea'),
					commentList: document.querySelector('.comment-list'),
					wordCount: document.querySelector('.word-count'),
					animatedSections: document.querySelectorAll('.movie-info, .synopsis, .comment-section'),
					avatars: document.querySelectorAll('.person-avatar, .user-avatar')
				};

				// 1. 灵魂火花效果（优化为圆形点）
				const spiritSparkColors = [
					'#4A6FA5', '#61A0AF', '#77C5D5', '#9DE0AD', 
					'#E8FCCF', '#F5D76E', '#F8C471', '#D2B4DE'
				];

				// 创建火花池提高性能（对象复用）
				const sparkPool = [];
				const MAX_POOL_SIZE = 200;

				// 从池获取或创建新火花（圆形点）
				function getSparkElement() {
					if (sparkPool.length > 0) {
						const spark = sparkPool.pop();
						spark.style.display = 'block';
						return spark;
					}
					
					const spark = document.createElement('div');
					spark.style.position = 'absolute';
					spark.style.pointerEvents = 'none';
					spark.style.borderRadius = '50%'; // 确保是圆形
					spark.style.zIndex = '999';
					spark.style.transform = 'translate(-50%, -50%)'; // 中心点对齐
					document.body.appendChild(spark);
					return spark;
				}

				// 回收火花到池
				function recycleSpark(spark) {
					if (sparkPool.length < MAX_POOL_SIZE) {
						spark.style.display = 'none';
						sparkPool.push(spark);
					} else {
						spark.remove();
					}
				}

				// 生成灵魂火花效果（优化为圆形点动画）
				function createSpiritSparks(x, y, isClick = false) {
					// 根据设备性能调整粒子数量
					const isTouchDevice = 'ontouchstart' in window;
					const isLowPerformance = isTouchDevice || window.innerWidth < 480;
					const particleCount = isClick 
						? (isLowPerformance ? 30 : 60) 
						: (isLowPerformance ? Math.floor(Math.random() * 15) + 5 : Math.floor(Math.random() * 25) + 10);
					
					// 粒子大小范围（更细腻的圆形点）
					const sizeRange = isClick ? [2, 8] : [1, 5];

					for (let i = 0; i < particleCount; i++) {
						const spark = getSparkElement();
						
						// 随机圆形样式
						const size = Math.random() * (sizeRange[1] - sizeRange[0]) + sizeRange[0];
						const color = spiritSparkColors[Math.floor(Math.random() * spiritSparkColors.length)];
						
						spark.style.width = `${size}px`;
						spark.style.height = `${size}px`;
						spark.style.backgroundColor = color;
						spark.style.boxShadow = `0 0 ${size * 3}px ${color}`; // 光晕效果增强圆形感
						spark.style.left = `${x}px`;
						spark.style.top = `${y}px`;
						spark.style.opacity = Math.random() * 0.8 + 0.2;
						
						// 灵魂漂浮轨迹计算（更自然的曲线）
						const angle = Math.random() * Math.PI * 2;
						const distance = isClick 
							? (isLowPerformance ? Math.random() * 80 + 50 : Math.random() * 150 + 80)
							: (isLowPerformance ? Math.random() * 60 + 30 : Math.random() * 100 + 50);
						
						const duration = isClick 
							? (isLowPerformance ? Math.random() * 1500 + 1000 : Math.random() * 2500 + 1500)
							: (isLowPerformance ? Math.random() * 2000 + 1500 : Math.random() * 4000 + 2000);
						
						// 随机添加上下浮动的波浪效果
						const waveAmp = Math.random() * 10 + 5; // 波浪振幅
						const waveFreq = Math.random() * 2 + 1; // 波浪频率
						
						// 运动向量
						const vx = Math.cos(angle) * distance;
						const vy = Math.sin(angle) * distance;
						
						// 动画帧处理（更平滑的缓动）
						let starttime = null;
						const requestAnimFrame = window.requestAnimationFrame || 
							window.webkitRequestAnimationFrame || 
							(callback => setTimeout(callback, 16));
							
						const animate = (timestamp) => {
							if (!starttime) starttime = timestamp;
							const progress = (timestamp - starttime) / duration;
							
							if (progress < 1) {
								// 缓动效果 + 波浪运动，模拟轻盈漂浮
								const easeProgress = 1 - Math.pow(1 - progress, 3);
								const waveOffset = Math.sin(progress * waveFreq * Math.PI) * waveAmp;
								
								spark.style.left = `${x + vx * easeProgress + waveOffset}px`;
								spark.style.top = `${y + vy * easeProgress + waveOffset}px`;
								spark.style.opacity = 1 - progress;
								// 圆形缩放效果增强
								spark.style.transform = `translate(-50%, -50%) scale(${1 - progress * 0.8})`;
								
								requestAnimFrame(animate);
							} else {
								recycleSpark(spark);
							}
						};
						
						requestAnimFrame(animate);
					}
				}

				// 点击页面任意位置触发火花
				document.addEventListener('click', (e) => {
					// 排除输入区域避免误触
					if (!e.target.closest('textarea, input, button')) {
						createSpiritSparks(e.clientX, e.clientY, true);
					}
				});

				// 随机位置自动生成火花（带性能控制）
				let sparkInterval;
				function startRandomSparks() {
					// 根据设备性能调整生成频率
					const isLowPerformance = 'ontouchstart' in window || window.innerWidth < 480;
					const baseDelay = isLowPerformance ? 5000 : 3000;
					const randomRange = isLowPerformance ? 3000 : 5000;
					
					function spawn() {
						// 视口可见时才生成
						if (document.visibilityState === 'visible') {
							const x = Math.random() * window.innerWidth;
							const y = Math.random() * window.innerHeight * 0.7;
							createSpiritSparks(x, y);
						}
						
						const nextDelay = Math.random() * randomRange + baseDelay;
						sparkInterval = setTimeout(spawn, nextDelay);
					}
					
					spawn();
				}

				// 页面可见性控制火花生成
				document.addEventListener('visibilitychange', () => {
					if (document.visibilityState === 'hidden' && sparkInterval) {
						clearTimeout(sparkInterval);
					} else if (document.visibilityState === 'visible') {
						startRandomSparks();
					}
				});

				// 2. 滚动动画（节流优化）
				function throttle(func, delay = 100) {
					let lastCall = 0;
					return (...args) => {
						const now = new Date().getTime();
						if (now - lastCall < delay) return;
						lastCall = now;
						return func(...args);
					};
				}

				const triggerScrollAnimations = throttle(() => {
					dom.animatedSections.forEach(el => {
						if (el.classList.contains('animated')) return;
						
						const rect = el.getBoundingClientRect();
						const isVisible = rect.top < window.innerHeight * 0.85;
						
						if (isVisible) {
							el.style.opacity = '1';
							el.style.transform = 'translateY(0)';
							el.classList.add('animated');
						}
					});
				});

				// 初始化滚动动画样式
				dom.animatedSections.forEach(el => {
					el.style.opacity = '0';
					el.style.transform = 'translateY(20px)';
					el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
				});

				// 3. 评论评分交互（增加悬停预览）
				if (dom.ratingStars) {
					let currentRating = 5; // 默认5星
					
					// 初始化星星颜色
					dom.ratingStars.style.color = '#F5D76E';
					
					// 悬停预览评分
					dom.ratingStars.addEventListener('mousemove', (e) => {
						const starWidth = dom.ratingStars.offsetWidth / 5;
						const hoverPos = e.offsetX;
						const hoverRating = Math.ceil(hoverPos / starWidth);
						dom.ratingStars.textContent = '★'.repeat(hoverRating) + '☆'.repeat(5 - hoverRating);
					});
					
					// 鼠标离开恢复当前评分
					dom.ratingStars.addEventListener('mouseleave', () => {
						dom.ratingStars.textContent = '★'.repeat(currentRating) + '☆'.repeat(5 - currentRating);
					});
					
					// 点击星星确认评分
					dom.ratingStars.addEventListener('click', (e) => {
						const starWidth = dom.ratingStars.offsetWidth / 5;
						const clickPos = e.offsetX;
						currentRating = Math.ceil(clickPos / starWidth);
						
						// 更新星星显示
						dom.ratingStars.textContent = '★'.repeat(currentRating) + '☆'.repeat(5 - currentRating);
						dom.ratingStars.style.color = currentRating > 3 ? '#F5D76E' : '#ccc';
						
						// 评分时触发小火花
						const rect = dom.ratingStars.getBoundingClientRect();
						createSpiritSparks(rect.left + clickPos, rect.top + rect.height/2, true);
					});
				}

				// 4. 发布评论功能（修复并完善）
				if (dom.submitBtn && dom.commentTextarea && dom.commentList && dom.wordCount) {
					// 实时字数统计
					dom.commentTextarea.addEventListener('input', () => {
						const currentLength = dom.commentTextarea.value.length;
						dom.wordCount.textContent = `${currentLength}/500`;
						
						// 输入超过10个字时激活按钮
						if (currentLength > 10 && currentLength <= 500) {
							dom.submitBtn.classList.add('active');
							dom.submitBtn.disabled = false;
						} else {
							dom.submitBtn.classList.remove('active');
							dom.submitBtn.disabled = true;
						}
					});

					// 提交评论
					dom.submitBtn.addEventListener('click', () => {
						const commentText = dom.commentTextarea.value.trim();
						if (!commentText) return;

						// 创建新评论元素
						const newComment = document.createElement('div');
						newComment.className = 'comment-card';
						newComment.style.opacity = '0';
						newComment.style.transform = 'translateY(10px)';
						newComment.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
						
						// 随机用户头像
						const avatars = ['img/c.jpg', 'img/y.jpg', 'img/yy.png'];
						const randomAvatar = avatars[Math.floor(Math.random() * avatars.length)];
						
						// 当前时间格式化
						const now = new Date();
						const timeStr = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;

						newComment.innerHTML = `
							<div class="comment-header">
								<img src="${randomAvatar}" alt="用户头像" class="user-avatar">
								<div class="user-info">
									<h4 class="user-name">访客</h4>
									<p class="comment-time">${timeStr}</p>
								</div>
								<div class="comment-rating">${'★'.repeat(currentRating)}${'☆'.repeat(5 - currentRating)}</div>
							</div>
							<p class="comment-content">${commentText}</p>
						`;

						// 添加到评论列表顶部
						dom.commentList.insertBefore(newComment, dom.commentList.firstChild);
						
						// 触发渐入动画
						setTimeout(() => {
							newComment.style.opacity = '1';
							newComment.style.transform = 'translateY(0)';
						}, 10);
						
						// 清空输入框并重置状态
						dom.commentTextarea.value = '';
						dom.wordCount.textContent = '0/500';
						dom.submitBtn.classList.remove('active');
						dom.submitBtn.disabled = true;
						
						// 发布成功触发火花效果
						const btnRect = dom.submitBtn.getBoundingClientRect();
						const centerX = btnRect.left + btnRect.width / 2;
						const centerY = btnRect.top + btnRect.height / 2;
						createSpiritSparks(centerX, centerY, true);
					});

					// 支持回车发布评论（Shift+Enter换行）
					dom.commentTextarea.addEventListener('keydown', (e) => {
						if (e.key === 'Enter' && !e.shiftKey) {
							e.preventDefault();
							if (dom.submitBtn.classList.contains('active')) {
								dom.submitBtn.click();
							}
						}
					});

					// 初始化按钮状态
					dom.submitBtn.disabled = true;
				}

				// 5. 响应式图片处理
				function handleResponsiveImages() {
					const windowWidth = window.innerWidth;
					const size = windowWidth < 768 ? '60px' : '80px';
					
					dom.avatars.forEach(img => {
						img.style.width = size;
						img.style.height = size;
					});
				}

				// 6. 平滑滚动
				document.querySelectorAll('a[href^="#"]').forEach(anchor => {
					anchor.addEventListener('click', function(e) {
						e.preventDefault();
						const targetId = this.getAttribute('href');
						if (targetId !== '#' && document.querySelector(targetId)) {
							document.querySelector(targetId).scrollIntoView({
								behavior: 'smooth'
							});
						}
					});
				});

				// 初始化
				window.addEventListener('load', () => {
					// 初始检查滚动动画
					triggerScrollAnimations();
					// 初始化响应式图片
					handleResponsiveImages();
					// 启动火花效果
					startRandomSparks();
					
					// 添加事件监听
					window.addEventListener('scroll', triggerScrollAnimations);
					window.addEventListener('resize', throttle(handleResponsiveImages, 300));
				});
			})();
		</script>
	</body>
</html>